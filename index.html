<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DevOps Blog - Deployment Leantime & Gatus</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1f1f1f;
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #333;
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
      color: #4CAF50;
    }
    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }
    article {
      margin-bottom: 40px;
    }
    h2 {
      color: #4CAF50;
      margin-top: 30px;
    }
    code, pre {
      background: #1e1e1e;
      padding: 12px;
      border-radius: 8px;
      display: block;
      overflow-x: auto;
      margin: 15px 0;
      font-family: "Courier New", monospace;
      font-size: 14px;
      color: #dcdcdc;
    }
    img {
      max-width: 100%;
      display: block;
      margin: 15px auto;
      border: 2px solid #333;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 15px;
      background: #1f1f1f;
      border-top: 2px solid #333;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <header>
    <h1>DevOps Blog</h1>
    <p>Ubuntu 22.04 | Docker | Kubernetes | Leantime & Gatus</p>
  </header>

  <main>
    <article>
      <h2>Topologi</h2>
      <p>Berikut adalah topologinya:</p>
      <img src="tugas fix .png" alt="Topologi Deployment">
    </article>

    <article>
      <h2>1. Operating System</h2>
      <p>Menggunakan <strong>Ubuntu 22.04</strong> sebagai basis sistem operasi.  
      Referensi: <a href="https://releases.ubuntu.com/jammy/" target="_blank">Ubuntu Jammy Release</a></p>
    </article>

    <article>
      <h2>2. Networking</h2>
      <p>
        tambahkan terlebih dahulu 
        <strong>Network Adapter Host-Only</strong> pada Virtual Machine.  
        Setelah itu atur IP statis sesuai kebutuhan (IP bebas, disesuaikan dengan jaringan).
      </p>
      <pre><code># Contoh konfigurasi netplan (silakan menyesuaikan)
network:
    ethernets:
        enp0s3:
            dhcp4: true
        enp0s8:
            dhcp4: false
            addresses:
            - 10.10.10.11/24
    version: 2</code></pre>
    </article>

    <article>
      <h2>3. Troubleshooting</h2>
      <p>Permasalahan <code>netplan apply</code> error karena <strong>Open vSwitch belum terinstall</strong>.  
      Solusi:</p>
      <pre><code>apt install openvswitch-switch</code></pre>
    </article>

    <article>
      <h2>4. Instalasi Docker</h2>
      <pre><code>sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y
sudo usermod -aG docker $USER
sudo chmod 666 /var/run/docker.sock</code></pre>
    </article>

    <article>
      <h2>5. Instalasi Kubernetes (k3d)</h2>
      <pre><code>wget -q -O - https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash
sudo apt update
sudo apt install docker.io -y
sudo usermod -aG docker $USER
sudo chmod 666 /var/run/docker.sock

curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin

# Membuat cluster k3d
sudo k3d cluster create leantime-cluster -s 1 -a 2 -p "8080:30080" -p "8081:30081"</code></pre>
    </article>

    <article>
      <h2>6. Deployment & Service Gatus</h2>
      <pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: gatus-config
data:
  config.yaml: |
    storage:
      type: sqlite
      path: data.db
    endpoints:
      - name: Leantime
        url: "http://leantime:8080"
        interval: 30s
        conditions:
          - "[STATUS] == 200"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatus
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gatus
  template:
    metadata:
      labels:
        app: gatus
    spec:
      containers:
        - name: gatus
          image: twinproduction/gatus:latest
          volumeMounts:
            - name: gatus-config
              mountPath: /config
          ports:
            - containerPort: 8080
      volumes:
        - name: gatus-config
          configMap:
            name: gatus-config
---
apiVersion: v1
kind: Service
metadata:
  name: gatus
spec:
  type: NodePort
  ports:
    - port: 8080
      nodePort: 30081
  selector:
    app: gatus</code></pre>
    </article>

    <article>
      <h2>7. Deployment & Service Leantime</h2>
      <pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: leantime
spec:
  replicas: 1
  selector:
    matchLabels:
      app: leantime
  template:
    metadata:
      labels:
        app: leantime
    spec:
      containers:
        - name: leantime
          image: leantime/leantime:latest
          ports:
            - containerPort: 8080
          env:
            - name: LEAN_DB_HOST
              value: mysql
            - name: LEAN_DB_USER
              value: lean
            - name: LEAN_DB_PASSWORD
              value: changeme123
            - name: LEAN_DB_DATABASE
              value: leantime
---
apiVersion: v1
kind: Service
metadata:
  name: leantime
spec:
  type: NodePort
  ports:
    - port: 8080
      nodePort: 30080
  selector:
    app: leantime</code></pre>
    </article>

    <article>
      <h2>8. Deployment & Service MySQL</h2>
      <pre><code>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
        - name: mysql
          image: mysql:8.4
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: changeme123
            - name: MYSQL_DATABASE
              value: leantime
            - name: MYSQL_USER
              value: lean
            - name: MYSQL_PASSWORD
              value: changeme123
          ports:
            - containerPort: 3306
          volumeMounts:
            - name: mysql-storage
              mountPath: /var/lib/mysql
      volumes:
        - name: mysql-storage
          persistentVolumeClaim:
            claimName: mysql-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: mysql
spec:
  ports:
    - port: 3306
  selector:
    app: mysql</code></pre>
    </article>
  </main>

  <footer>
    <p>© 2025 DevOps Blog | Ubuntu · Docker · Kubernetes</p>
  </footer>
</body>
</html>
